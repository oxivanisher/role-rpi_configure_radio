---

# ensure mounted boot
- name: mount boot
  ansible.posix.mount:
    path: /boot
    state: mounted
    src: /dev/mmcblk0p1
    fstype: vfat
  changed_when: false

- name: "disable wifi in /boot/config.txt"
  ansible.builtin.lineinfile:
    path: /boot/config.txt
    regexp: 'dtoverlay=disable-wifi'
    line: "dtoverlay=disable-wifi"
  notify: reboot required
  when: rpi_disable_radio_wifi
  ignore_errors: "{{ ansible_check_mode }}"

- name: "enable wifi in /boot/config.txt"
  ansible.builtin.lineinfile:
    path: /boot/config.txt
    regexp: 'dtoverlay=disable-wifi'
    line: "#dtoverlay=disable-wifi"
  notify: reboot required
  when: not rpi_disable_radio_wifi
  ignore_errors: "{{ ansible_check_mode }}"

- name: "disable bluetooth in /boot/config.txt"
  ansible.builtin.lineinfile:
    path: /boot/config.txt
    regexp: 'dtoverlay=disable-bt'
    line: "dtoverlay=disable-bt"
  notify: reboot required
  when: rpi_disable_radio_bt
  ignore_errors: "{{ ansible_check_mode }}"

- name: "enable bluetooth in /boot/config.txt"
  ansible.builtin.lineinfile:
    path: /boot/config.txt
    regexp: 'dtoverlay=disable-bt'
    line: "#dtoverlay=disable-bt"
  notify: reboot required
  when: not rpi_disable_radio_bt
  ignore_errors: "{{ ansible_check_mode }}"
